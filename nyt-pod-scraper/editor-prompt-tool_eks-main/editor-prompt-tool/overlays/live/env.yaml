apiVersion: apps/v1
kind: Deployment
metadata:
  # namespace: nextjs
  name: editor-prompt-tool
spec:
  template:
    spec:
      containers:
        - name: editor-prompt-tool
          env:
            - name: AWS_REGION
              value: eu-west-1
            - name: CLUSTER_NAME
              value: ekslive
            - name: LISTEN_ADDRESS
              value: 0.0.0.0:80
            - name: OTEL_EXPORTER_OTLP_ENDPOINT
              value: http://collector-xray-collector.opentelemetry:4317
            - name: OTEL_EXPORTER_OTLP_PROTOCOL
              value: grpc
            - name: OTEL_RESOURCE_ATTRIBUTES
              value: service.namespace=editor-prompt,service.name=editor-prompt-tool
            - name: OTEL_SERVICE_NAME
              value: editor-prompt-tool
            - name: OTEL_TRACES_EXPORTER
              value: otlp
            - name: OTEL_METRICS_EXPORTER
              value: none
            - name: MY_KG_APP_API_URL
              value: https://editor-prompt-tool.editor-prompt.live.eks.bmjgroup.com
            # Application Configuration
            - name: SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: SECRET_KEY
            - name: FLASK_ENV
              value: "live"

            # Database Configuration
            # - name: DATABASE_URL
            #   value: "sqlite:///app.db"
            - name: DATABASE_URL #postgresql://username:password@your-rds-endpoint.amazonaws.com:5432/bmj_prompt_tool
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: DATABASE_URL

            # - name: DATABASE_URL
            #   value: "postgresql://username:password@your-rds-endpoint.amazonaws.com:5432/dbname"

            # PostgreSQL Connection Pool Settings (optional)
            - name: DB_POOL_SIZE
              value: "10"
            - name: DB_POOL_RECYCLE
              value: "3600"
            - name: DB_POOL_PRE_PING
              value: "True"

            # Session Configuration
            - name: SESSION_TYPE
              value: "filesystem"  # Options: filesystem, redis
            - name: SESSION_LIFETIME_HOURS
              value: "24"

            # Redis Configuration (if using Redis for sessions)
            # - name: REDIS_URL
            #   value: "redis://localhost:6379/0"

            # File Storage Configuration
            - name: STORAGE_TYPE
              value: "s3"  # Options: local, s3

            # Local Storage Settings
            - name: UPLOAD_FOLDER
              value: "app/static/uploads"

            # S3 Storage Settings (if STORAGE_TYPE=s3)
            - name: AWS_S3_BUCKET
              value: "editor-prompt-tool-live"
            - name: AWS_REGION
              value: "eu-west-1"
            # - name: AWS_S3_CUSTOM_DOMAIN
            #   value: "your-cloudfront-domain.cloudfront.net"

            # AWS Credentials (for S3 and Bedrock)
            # - name: AWS_ACCESS_KEY_ID
            #   value: "your-access-key"
            # - name: AWS_SECRET_ACCESS_KEY
            #   value: "your-secret-key"

            # Upload Settings
            - name: MAX_CONTENT_LENGTH
              value: "16777216"  # 16MB in bytes
            - name: ALLOWED_EXTENSIONS
              value: "txt,pdf,doc,docx"

            # Authentication Settings
            - name: ALLOW_REGISTRATION
              value: "True"
            - name: ALLOW_TEST_USERS
              value: "False"
            - name: BMJ_EMAIL_DOMAIN
              value: "bmj.com"

            # Google OAuth Configuration
            - name: GOOGLE_CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: GOOGLE_CLIENT_ID
            - name: GOOGLE_CLIENT_SECRET
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: GOOGLE_CLIENT_SECRET

            # LLM API Keys
            - name: OPENAI_API_KEY
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: OPENAI_API_KEY
            - name: ANTHROPIC_API_KEY
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: ANTHROPIC_API_KEY
            - name: GOOGLE_AI_API_KEY
              valueFrom:
                secretKeyRef:
                  name: editor-prompt-tool
                  key: GOOGLE_AI_API_KEY

            # Test Users (JSON array format)
            # - name: TEST_USERS
            #   value: "[\"test1@example.com\", \"test2@example.com\"]"

            # Pagination
            - name: RESULTS_PER_PAGE
              value: "10"
